<!DOCTYPE html>
<html>
<head>
    <title id="hw_title"></title>
    <link rel="stylesheet" href="css/default.css" />
    <script src="js/dbtools.js"></script>
    <script src="js/dispatchHandler.js"></script>
</head>
<body onload="javascript: dispatcher.GeneratePage(document.getElementById('hw_questionSelect').value);">
    <div id="hw_loadingContent">
        <p>Loading...</p>
    </div>
    <div id="hw_allContent">
        <!--hw_fixedContent are elements that should exists on every page and do not change much-->
        <div id="hw_fixedContent">
            <span class="hw quest_select">
                Select a Question:
                <select id="hw_questionSelect" onchange="javascript: dispatcher.GeneratePage(document.getElementById('hw_questionSelect').value);">
                    <option value="Q1A">Question 1: Part A</option>
					<option value="Q1B">Question 1: Part B</option>
                    <option value="Q1C">Question 1: Part C</option>
                    <option value="Q1D">Question 1: Part D</option>
                    <option value="Q1E">Question 1: Part E</option>
                    <option value="Q2">Question 2: Part A - D</option>
                    <option value="Q3AB">Question 3: Part A - B</option>
                    <option value="Q3CD">Question 3: Part C - D</option>
                    <option value="Q6">Question 6</option>
                </select>
            </span>
        </div>
        <h3 class="hw" id="hw_heading"></h3>
        <div id="hw_dynamicContent"></div>
    </div>
    <script>
        //Removes all child nodes from the main content
        function Clear_DynamicContentNodes() {
            let doc = document.getElementById('hw_dynamicContent');
            while (doc.firstChild) {
                doc.removeChild(doc.firstChild);
            }
        }
        //Removes all child nodes of element with given id
        function Clear_ByElementId(elemID) {
            let e = document.getElementById(elemID);
            if (e !== null) {
                while (e.firstChild) {
                    e.removeChild(e.firstChild);
                }
            }
        }
        
        //Hide "hw_allContent" div and show "hw_loadingContent" div
        function Hide_AllContentNodes(makeHidden) {
            let doc = document.getElementById('hw_allContent');
            let ld = document.getElementById('hw_loadingContent');
            if (makeHidden === undefined || !(makeHidden === false)) {
                makeHidden = true;
            }
            if (makeHidden) {
                doc.setAttribute('hidden', 'true');
                ld.removeAttribute('hidden');
            } else {
                doc.removeAttribute('hidden');
                ld.setAttribute('hidden', 'true');
            }
        }
        //Changes title
        function Alter_Title(str) {
            document.getElementById('hw_title').innerText = str;
        }
        //Changes fixed page heading
        function Alter_Heading(str) {
            document.getElementById('hw_heading').innerText = str;
        }
        //Generic callback for XMLHttpResponse
        function Insert_ResponseText(res, elemID) {
            if (document.getElementById(elemID) === null) {
                console.log(elemID + " was not found.");
            } else {
                document.getElementById(elemID).appendChild(document.createElement('div'));
                document.getElementById(elemID).lastChild.outerHTML = res.responseText;
            }
        }
        //Appends user summary table to given element
        function Insert_UserSummaryTable(elemID) {
            if (document.getElementById(elemID) === null) {
                console.log(elemID + " was not found.");
            } else {
                getUserSummaryTable(
                    function (res) {
                        document.getElementById(elemID).appendChild(document.createElement('div'));
                        document.getElementById(elemID).lastChild.outerHTML = res.responseText;
                    },
                    false);
            }
        }
        //Generic clean page function
        function Clear_Page() {
            Hide_AllContentNodes(true);
            Clear_DynamicContentNodes();
            Hide_AllContentNodes(false);
        }
        //Q1A Related functions
        function Q1A_GeneratePage() {
            Hide_AllContentNodes(true);
            Alter_Title('Question 1: Part A');
            Alter_Heading('The table below displays the current users already in the database. Please create a user account. After creating the account you should see it displayed in the user table.');
            //adds a div element and 2 child div elements that float left (form0) and right (table0)
            Clear_ByElementId('table0');
            Q1A_AddContentBox();
            Q1A_AddSignUpForm();
            db_UserTable(
                Insert_ResponseText,
                'table0',
                false);
            
            
            Hide_AllContentNodes(false);
        }
        function Q1A_AddContentBox() {
            var doc = document.getElementById('hw_dynamicContent');
            var cbox = document.createElement('div');
            cbox.setAttribute('id', 'hw_Q1A_contentBox');
            cbox.appendChild(document.createElement('div'));
            cbox.lastChild.setAttribute('id', 'form0');
            cbox.lastChild.setAttribute('style', 'float:left');
            cbox.appendChild(document.createElement('div'));
            cbox.lastChild.setAttribute('id', 'table0');
            cbox.lastChild.setAttribute('style', 'float:left; margin-left: 5%;');

            doc.appendChild(cbox);
        }
        function Q1A_AddSignUpForm() {
            var doc = document.getElementById('form0');
            Clear_ByElementId('signUpForm');
            doc.appendChild(document.createElement('div'));
            doc.lastChild.outerHTML = "<form action=\"javascript:Q1A_SignUpNewUser()\" method=\"post\" id=\"signUpForm\">" +
                    "<table id=\"formFields\">" +
                    "<tr>" +
                        "<td>User Name:</td>" +
                        "<td><input type=\"text\" id=\"name\" name=\"name\" size=\"32\" required placeholder=\"Enter User Name...\" /></td> <!--this will be inserted to user.user_name in MySQl database-->" +
                    "</tr>" +
                    "<tr>" +
                    "    <td>Email:</td> " +
                    "    <td><input type=\"email\" id=\"email\" name=\"email\" size=\"128\" required placeholder=\"Enter Email Address...\" /></td> <!--this will be inserted to user.email in MySQL database--> " +
                    "</tr> " +
                    "<tr> " +
                    "    <td>User Type:</td> " +
                    "    <td><select id=\"userTypes\"></select></td> " +
                    "</tr> " +
                    "<tr> " +
                    "    <td>Password:</td> " +
                    "    <td><input type=\"password\" id=\"password\" name=\"password\" required placeholder=\"Enter a password...\" /></td> " +
                    "</tr> " +
                    "<tr> " +
                    "    <td></td> " +
                    "    <td><input type=\"submit\" name=\"submit\" value=\"Sign Up\" /></td> " +
                    "</tr> " +
                "</table> " +
            "</form>";
            db_UserTypes(
                Insert_ResponseText,
                'type',
                false
            );
            doc.lastElementChild.setAttribute('class', 'usr-form');
            doc.lastElementChild.setAttribute('style', 'width:100%;clear:both;float:left;');
            doc.setAttribute('style', 'max-width: 35%;');

        }
        //inserts new user to the user table
        function Q1A_SignUpNewUser() {
            let name = document.getElementById('name').value;
            let email = document.getElementById('email').value;
            let type = document.getElementById('userTypes').value;
            let password = document.getElementById('password').value;
            if (document.getElementById('msg0') === null) {
                document.getElementById('signUpForm').appendChild(document.createElement('p'));
                document.getElementById('signUpForm').lastElementChild.setAttribute('id', 'msg0');
            }
            signUp(
                function (res) {
                    if (res.responseText === "") {
                        Clear_ByElementId('table0');
                        Insert_UserTable('table0');
                        document.getElementById('msg0').innerText = "You should see the new user account in the table to the right.";
                    } else {
                        document.getElementById('msg0').innerText = res.responseText;
                    }
                },
                name,
                email,
                type,
                password,
                false);
        }
        //Q1B functions
        function Q1B_GeneratePage() {
            Hide_AllContentNodes(true);
            Alter_Title("Question 1: Part B");
            Alter_Heading("The table on the left is the user table. The table on the right is a query of the user table grouped by user type with aggregate functions COUNT(user_id) and MAX(reg_date)");
            Q1B_AddContentBox();
            db_UserTable(
                Insert_ResponseText,
                'table0',
                false);
            db_UserSummaryTable(
                Insert_ResponseText,
                'table1',
                false);
            document.getElementById('table1').getElementsByTagName('table')[0].setAttribute('style', 'width: 100%'); //php function sets width to 50% by default, just removing it here instead of in php
            Hide_AllContentNodes(false);
        }
        function Q1B_AddContentBox() {
            var doc = document.getElementById('hw_dynamicContent');
            var cbox = document.createElement('div');
            cbox.setAttribute('id', 'hw_Q1B_contentBox');
            cbox.appendChild(document.createElement('div'));
            cbox.lastChild.setAttribute('id', 'table0');
            cbox.lastChild.setAttribute('style', 'float:left;max-width: 48%;');
            cbox.appendChild(document.createElement('div'));
            cbox.lastChild.setAttribute('id', 'table1');
            cbox.lastChild.setAttribute('style', 'float:left;margin-left: 5%;max-width: 48%;');
            doc.appendChild(cbox);
        }
        function Q1C_GeneratePage() {
            Hide_AllContentNodes(true);
            Alter_Title('Question 1: Part C');
            Alter_Heading('Below is a query that displays the name of each location (from the location table), the number of entrees and average entree price by location (from the entree table).');
            Q1C_AddContentBox();
            getLocEntreeSummaryTable(Insert_ResponseText, 'queryTable', false);
            db_LocationTable(Insert_ResponseText, 'locTable', false);
            db_EntreeTable(Insert_ResponseText, 'entreeTable', false);
            Hide_AllContentNodes(false);

        }
        function Q1C_AddContentBox() {
            let doc = document.getElementById('hw_dynamicContent');
            let box0 = document.createElement('div'); //for query
            let box1 = document.createElement('div'); //for original tables
            let locBox = document.createElement('div'); //for location table and title
            let entreeBox = document.createElement('div'); //for entree table and title
            let t0 = document.createElement('div'); //for query table
            let t1 = document.createElement('div'); //for location table
            let t2 = document.createElement('div'); //for entree table
            let h0 = document.createElement('h3'); //For query table title
            let h1 = document.createElement('h3'); //For location table title
            let h2 = document.createElement('h3'); //For entree table title

            //setting id attributes of elements
            box0.setAttribute('id', 'queryBox');
            box1.setAttribute('id', 'baseTableBox');
            locBox.setAttribute('id', 'locBox');
            entreeBox.setAttribute('id', 'entreeBox');

            t0.setAttribute('id', 'queryTable');
            t1.setAttribute('id', 'locTable');
            t2.setAttribute('id', 'entreeTable');

            h0.setAttribute('id', 'queryTableTitle');
            h1.setAttribute('id', 'locTableTitle');
            h2.setAttribute('id', 'entreeTableTitle');

            //assign text to table titles
            h0.innerText = "Query on two base tables with two aggregate functions.";
            h1.innerText = "Location (base table)";
            h2.innerText = "Entree (base table)";

            //setting style attributes of elements
            t0.setAttribute('style', 'width:100%');
            locBox.setAttribute('style', 'max-width:45%;float:left');
            entreeBox.setAttribute('style', 'max-width:45%;float:right;');
            h1.setAttribute('style', 'clear:both;');
            h2.setAttribute('style', 'clear:both;');
            t1.setAttribute('style', 'clear:both;');
            t2.setAttribute('style', 'clear:both;');
            box1.setAttribute('style', 'margin-top: 5%;')
            //append elements to boxes
            locBox.appendChild(h1);
            locBox.appendChild(t1);
            entreeBox.appendChild(h2);
            entreeBox.appendChild(t2);
            box0.appendChild(h0);
            box0.appendChild(t0);
            box1.appendChild(locBox);
            box1.appendChild(entreeBox);
            doc.appendChild(box0);
            doc.appendChild(box1);
        }
        function Q1D_GeneratePage() {
            Hide_AllContentNodes(true);
            Alter_Title('Question 1: Part D');
            Alter_Heading('The table below is a query of all restaurant users that have total locations greater than or equal the number specified in the input box. The query uses a GROUP BY(restaurant_id) HAVING COUNT(location_id) >= ?. Change the number in the box below to see the query change. You may also select a restaurant and add locations')
            Q1D_AddContentBox();
            db_RestaurantMinLocationTable(Insert_ResponseText, 0, 'locTable', false);
            Hide_AllContentNodes(false);
        }
        function Q1D_AddContentBox() {
            let box0 = document.createElement('div');
            let box1 = document.createElement('div');
            let table0 = document.createElement('div');
            let numInput = document.createElement('input');
            let numPrompt = document.createElement('p');
            
            numInput.setAttribute('id', 'locMin');
            numInput.setAttribute('type', 'number');
            numInput.setAttribute('min', '0');
            numInput.setAttribute('max', '999');
            numInput.setAttribute('value', '0');
            numInput.setAttribute('style', "float:right;width:80px;padding: 4px;");
            numInput.setAttribute('onchange', 'javascript:Q1D_UpdateRestMinTable();')
            numPrompt.setAttribute('id', 'numPrompt');
            numPrompt.setAttribute('style', "float:left;margin-right: 5px;display:inline-block;font-size:9pt;font-family:'Droid Sans',sans-serif;overflow-wrap:normal;")
            numPrompt.innerText = "Change the number to update table and/or and a new location for an existing restaurant user.";
            box0.setAttribute('id', 'inBox');
            box0.setAttribute('style', 'clear:both;float:left;max-width: 45%;');
            box0.appendChild(numPrompt);
            box0.appendChild(numInput);
            box0.appendChild(Q1D_CreateAddLocForm());
            box1.setAttribute('id', 'displayBox');
            box1.setAttribute('style', 'float:left; margin-left: 5%; max-width: 45%;');
            table0.setAttribute('id', 'locTable');
            table0.setAttribute('style', 'clear:both; width:100%');
            box1.appendChild(table0);
            document.getElementById('hw_dynamicContent').appendChild(box0);
            document.getElementById('hw_dynamicContent').appendChild(box1);
        }
        function Q1D_CreateAddLocForm() {
            var locForm = document.createElement('form');
            var restIDs = document.createElement('span');
            var locName = document.createElement('input');
            var locCountry = document.createElement('select');
            var locState = document.createElement('select');
            var locCity = document.createElement('input');
            var locAddr = document.createElement('input');
            var locZip = document.createElement('input');
            var locPhone = document.createElement('input');
            var locSubmit = document.createElement('input');
            var fldTable = document.createElement('table');
            locForm.setAttribute('id', 'addLocForm');
            locForm.setAttribute('class', 'usr-form');
            locForm.setAttribute('style', 'clear:both');
            locForm.setAttribute('action', 'javascript:Q1D_AddLocation();');
            db_RestaurantIDAndNameList(function (res, elem) {
                elem.innerHTML = res.responseText;
                elem.firstElementChild.setAttribute('id', 'restid');
            },
            restIDs,
            false);
            locName.setAttribute('id', 'name');
            locName.setAttribute('type', 'text');
            locName.setAttribute('placeholder', 'Enter Location Name');
            locCountry.innerHTML = "<select><option value='US'>US</option></select>";
            locCountry.setAttribute('id', 'country');
            db_StateCodeList(
                function (res, elem) {
                    elem.innerHTML = res.responseText;
                    elem.setAttribute('id', 'state');
                },
                locState,
                false);
            locCity.setAttribute('id', 'city');
            locCity.setAttribute('type', 'text');
            locCity.setAttribute('placeholder', 'Enter City...');
            locCity.setAttribute('required', 'true');
            locAddr.setAttribute('id', 'addr');
            locAddr.setAttribute('type', 'text');
            locAddr.setAttribute('placeholder', 'Enter Street Address...');
            locZip.setAttribute('id', 'zip');
            locZip.setAttribute('type', 'text');
            locZip.setAttribute('placeholder', 'Enter Zip Code...');
            locPhone.setAttribute('id', 'phone');
            locPhone.setAttribute('type', 'tel');
            locPhone.setAttribute('placeholder', 'Enter Phone Number...');
            locSubmit.setAttribute('id', 'submit');
            locSubmit.setAttribute('type', 'submit');
            locSubmit.setAttribute('value', 'Add Location');
            locForm.appendChild(
                Utility_AppendForm(
                'fieldTable',
                ['Select a Restaurant User', 'Name', 'Country', 'State', 'City', 'Street', 'Zip', 'Phone', ''],
                [restIDs, locName, locCountry, locState, locCity, locAddr, locZip, locPhone, locSubmit])
            );
            return locForm;
        }
        function Utility_FormEntry(labelTxt, inputElem) {
            var formEntry = document.createElement('tr');
            var lbl = document.createElement('td');
            var inElem = document.createElement('td');
            lbl.innerText = labelTxt;
            inElem.appendChild(inputElem);
            formEntry.appendChild(lbl);
            formEntry.appendChild(inElem);
            return formEntry;
        }
        function Q1D_AddLocation() {
            let rid = document.getElementById('restid').value;
            let name = document.getElementById('name').value;
            let country = document.getElementById('country').value;
            let state = document.getElementById('state').value;
            let city = document.getElementById('city').value;
            let addr = document.getElementById('addr').value;
            let zip = document.getElementById('zip').value;
            let phone = document.getElementById('phone').value;
            db_AddLocation(
            function (res, elem) {
                if (res.responseText === "") {
                    Q1D_UpdateRestMinTable();
                } else {
                    console.log("Error: " + res.responseText);
                }
            },
            rid, name, country, state, city, addr, zip, phone, 'locTable', false);
        }
        function Q1D_UpdateRestMinTable() {
            Clear_ByElementId('locTable');
            db_RestaurantMinLocationTable(
            Insert_ResponseText,
            document.getElementById('locMin').value,
            'locTable',
            false);
        }
        function Q1E_GeneratePage() {
            Hide_AllContentNodes(true);
            Alter_Title('Question 1: Part E');
            Alter_Heading('The table below is the same table from Q1.D. Left outer joins are used to get the user_name from the user table and the location count from the location table. The SQL Statement is: \"SELECT USR.user_name, COUNT(LOC.location_id) FROM restaurant AS REST LEFT OUTER JOIN user as USR ON REST.user_id = USR.user_id LEFT OUTER JOIN location AS LOC ON LOC.restaurant_id = REST.restaurant_id GROUP BY REST.restaurant_id HAVING COUNT(LOC.location_id) >= 1 ORDER BY COUNT(LOC.location_id) DESC\"');
            var table0 = document.createElement('div');
            table0.setAttribute('id', 'table0');
            document.getElementById('hw_dynamicContent').appendChild(table0);
            db_RestaurantMinLocationTable(
            Insert_ResponseText,
            1,
            'table0',
            false);
            Hide_AllContentNodes(false);
        }
        function Q2_GeneratePage_Part2() {
            Clear_DynamicContentNodes();
            Hide_AllContentNodes(true);
            Alter_Title('Question 2: Part A-D');
            Alter_Heading('The user_generated_v and user_generate2_v are views that have been and displayed below. All views in the database are listed on the far right');
            Q2_AddContentBox();
            Q2_UpdateViewBox();
            Hide_AllContentNodes(false);

        }
        function Q2_GeneratePage() {
            Hide_AllContentNodes(true);
            Alter_Title('Question 2: Part A-D');
            Alter_Heading('Below are the current views in the database. Click the button to create a view named user_generated_v');
            let x = document.createElement('div');
            x.setAttribute('id', 'viewsTable');
            document.getElementById('hw_dynamicContent').appendChild(x);
            db_DropView(
                function (res) {
                },
                'user_generated_v',
                undefined,
                false);
            db_DropView(
                function (res) {
                },
                'user_generate2_v',
                undefined,
                false);
            db_ShowViews(
                Insert_ResponseText,
                'viewsTable',
                false);
            let y = document.createElement('div');
            let b = document.createElement('input');
            Utility_SetAttrVariable([b, b, b, b], ['type', 'id', 'value', 'onclick'], ['button', 'createButton', 'Create View', 'javascript:Q2_GeneratePage_Part2();']);
            y.appendChild(b);
            document.getElementById('hw_dynamicContent').appendChild(y);
            Hide_AllContentNodes(false);

        }
        function Q2_AddContentBox() {
            let box0 = document.createElement('div');
            let box1 = document.createElement('div');
            let locBox = document.createElement('select');
            let entreeForm = document.createElement('form');
            let name = document.createElement('input');
            let desc = document.createElement('input');
            let price = document.createElement('input');
            let viewBox = document.createElement('div');
            let locTable = document.createElement('div');
            let entreeTable = document.createElement('div');
            let tablesTable = document.createElement('div');
            let entreeSubmit = document.createElement('input');
            let viewBoxTitle = document.createElement('p');
            let box2 = document.createElement('div');
            let delButton = document.createElement('input');
            let view2Box = document.createElement('div');
            Utility_SetAttr(
                view2Box,
                ['id'],
                ['view2Box']);
            Utility_SetAttrVariableValues(
                [name,desc,price,locBox, entreeForm, box0, box1, viewBox, locTable, entreeTable, viewBoxTitle, box2, tablesTable],
                'id',
                ['name', 'desc', 'price', 'locid', 'entreeForm', 'box0', 'box1', 'viewBox', 'locTable', 'entreeTable', 'viewBoxTitle','box2', 'tablesTable']);
            Utility_SetAttrIdentical([name, desc], 'type', 'text');
            Utility_SetAttrVariable([price, price], ['type', 'step','min','max'], ['number', '0.01','0','99']);
            Utility_SetAttrVariable([entreeSubmit, entreeSubmit, entreeSubmit], ['type', 'id', 'value'], ['submit', 'submit', 'Add Entree']);
            Utility_SetAttrVariableValues([name, desc, price], 'placeholder', ['Enter Entree Name...', 'Enter Entree Description...', 'Enter Entree Price...']);
            Utility_SetAttrIdentical([name, desc, price], 'size', 32);
            Utility_SetAttr(delButton, ['id', 'type', 'name', 'onclick', 'value'], ['delButton', 'button', 'delButton', 'javascript:Clear_DynamicContentNodes();Q2_GeneratePage();', 'Delete View']);
            db_LocationIDAndNameList(
                function (res, elem) {
                    elem.innerHTML = res.responseText;
                    elem.setAttribute('id', 'locid');
                },
                locBox,
                false);
            
            locBox.setAttribute('onchange', 'javascript:Q2_UpdateViewBox();');
            box0.setAttribute('style', 'float:left;max-width:42%;');
            entreeForm.setAttribute('class', 'usr-form');
            entreeForm.setAttribute('action', 'javascript:Q2_AddEntree();');
            entreeForm.appendChild(Utility_AppendForm('formFields', ['Select Location', 'Name', 'Description', 'Price', ''], [locBox, name, desc, price, entreeSubmit]));
            box0.appendChild(entreeForm);
            box1.setAttribute('style', 'clear:both;float:left;');
            viewBoxTitle.innerText="The view on the left (user_generated_v) is a view on a single table (entree). The view on the right (user_generate2_v) is a view on 2 tables (entree, location). Use the form above to insert records that will update the views."
            viewBoxTitle.setAttribute('style', "clear:both;font-family:'Droid Sans',sans-serif;font-size:14pt;font-weight:bold;color:blue;");
            box1.appendChild(viewBoxTitle);
            box1.appendChild(viewBox);
            box1.appendChild(view2Box);
            Utility_SetAttrVariableValues([box2, tablesTable], 'style', ['margin-left: 3%;float:left;max-width: 42%;', 'width:100%;']);
            box2.appendChild(tablesTable);
            box0.appendChild(delButton);
            Utility_SetAttr(view2Box, ['style'], ['float:left;']);
            Utility_SetAttr(viewBox, ['style'], ['clear:both;float:left;']);
            document.getElementById('hw_dynamicContent').appendChild(box0);
            document.getElementById('hw_dynamicContent').appendChild(box2);
            document.getElementById('hw_dynamicContent').appendChild(box1);
            
        }
        function Q2_UpdateViewBox() {
            Clear_ByElementId('viewBox');
            Clear_ByElementId('view2Box');
            Clear_ByElementId('tablesTable');
            let t0 = document.getElementById('viewBox');
            let t1 = document.getElementById('tablesTable');
            let t2 = document.getElementById('view2Box');
            let p0 = document.getElementById('viewBoxTitle');
            Utility_SetAttrIdentical([t0, t1, t2,p0], 'hidden', true);
            db_CreateEntreeView(
            Insert_ResponseText,
            document.getElementById('locid').value.split(',')[1],
            'viewBox',
            false);
            db_CreateLocEntreeView(
            Insert_ResponseText,
            document.getElementById('locid').value.split(',')[1],
            'view2Box',
            false);
            db_ShowViews(
                Insert_ResponseText,
                'tablesTable',
                false);
            t0.removeAttribute('hidden');
            t1.removeAttribute('hidden');
            t2.removeAttribute('hidden');
            p0.removeAttribute('hidden');
        }
        function Q2_AddEntree() {
            let name = document.getElementById('name').value;
            let desc = document.getElementById('desc').value;
            let price = document.getElementById('price').value;
            let locid = document.getElementById('locid').value.split(',')[1];
            db_AddEntree(
                function (res) {
                    if (res.responseText) {
                        Q2_UpdateViewBox();
                    } else {
                        console.log('Add entree failed');
                    }
                },
                name,
                desc,
                price,
                locid,
                undefined,
                false);
        }    
        function Q3AB_GeneratePage() {
            Hide_AllContentNodes(true);
            Alter_Title("Question 3: Part A-B");
            Alter_Heading('The current tables are listed below. Click the button to create a new table.');
            let dc = document.getElementById('hw_dynamicContent');
            let tbl = document.createElement('div');
            let btn = document.createElement('input');
            let p0 = document.createElement('p');
            let dsc = document.createElement('div');

            //set table element attribs
            Utility_SetAttrVariableValues([tbl, dsc, p0], 'id', ['tblOtables', 'tblDesc', 'p0']);
            //set button attribs
            Utility_SetAttr(
                btn,
                ['id', 'type', 'value', 'onclick'],
                ['createTblBtn', 'button', 'Create Table', 'javascript:Q3AB_CreateTableHandler();']
            );
            Utility_AppendChildern(dc, [tbl, btn, p0, dsc]);
            Q3AB_DeleteTable();
            Q3AB_UpdateTablesOTables();
            Hide_AllContentNodes(false);
        }
        function Q3AB_CreateTableHandler() {
            Hide_AllContentNodes(true);
            Q3AB_CreateTable();
            Q3AB_UpdateTablesOTables();
            Q3AB_DescribeEntreeClass();
            Q3AB_ButtonSwap();
            Hide_AllContentNodes(false);
        }
        function Q3AB_UpdateTablesOTables() {
            Clear_ByElementId('tblOtables');
            db_Tables(
                Insert_ResponseText,
                'tblOtables',
                false
            );
        }
        function Q3AB_CreateTable() {
            db_CreateEntreeClassTable(
                function (res) {
                },
                undefined,
                false
            );
        }
        function Q3AB_ButtonSwap() {
            document.getElementById('createTblBtn').remove();
            let b = document.createElement('input');
            Utility_SetAttr(
                b,
                ['id','type','value','onclick'],
                ['delBtn','button','Delete Table','javascript:Q3AB_DeleteTableHandler();']
            );
            document.getElementById('hw_dynamicContent').appendChild(b);
        }
        function Q3AB_DeleteTableHandler() {
            Clear_DynamicContentNodes();
            Q3AB_GeneratePage();
        }
        function Q3AB_DeleteTable() {
            db_DeleteEntreeClassTable(
                function(res) {},
                undefined,
                false
            );
        }
        function Q3AB_DescribeEntreeClass() {
            db_TableDescription(
                Insert_ResponseText,
                'entree_class',
                'tblDesc',
                false
            );
            document.getElementById('p0').innerText = "entree_class table description is below.";
        }
        function Q3CD_GeneratePage() {
            //hide everything/show Loading...
            Hide_AllContentNodes(true);
            //update title and heading
            Alter_Title("Question 3: Part C - D"); 
            Alter_Heading("Below is the current entree table and it's description. Click the button to add a new column to the table");

            //create some elements
            let t0 = document.createElement('div'); //entree table
            let t1 = document.createElement('div'); //entree table desc.
            let box0 = document.createElement('div') //container for t0 & t1
            let btn = document.createElement('input'); //button to add new column


            //set element attributes
            Utility_SetAttrVariableValues(
                [t0, t1, box0, btn],
                'id',
                ['entreeTbl','entreeDsc','box0','btn']
            );
            Utility_SetAttrVariableValues(
                [t0,t1],
                'style',
                ['clear:both;float:left;max-width: 42%;','float:left;margin-left:5%;']
            );
            Utility_SetAttr(
                btn,
                ['type','value','onclick','style'],
                ['button','Add Column','javascript:Q3CD_InsertNewColumnHandler();','float:left;margin: 1.5%;']
            );

            //append elements to doc tree
            Utility_AppendChildern(box0, [btn, t0, t1]);
            document.getElementById('hw_dynamicContent').appendChild(box0);

            //Make sure the 'entree_class' column does not already exist
            Q3CD_DeleteNewColumn();

            //Get entree table and its description
            Q3CD_UpdateEntreeTable();
            Q3CD_UpdateEntreeTableDesc();

            //unhide everything
            Hide_AllContentNodes(false);

        }
        function Q3CD_UpdateEntreeTable() {
            Clear_ByElementId('entreeTbl');
            db_EntreeTable(
                Insert_ResponseText,
                'entreeTbl',
                false
            );
        }
        function Q3CD_UpdateEntreeTableDesc() {
            Clear_ByElementId('entreeDsc');
            db_TableDescription(
                Insert_ResponseText,
                'entree',
                'entreeDsc',
                false   
            );
        }
        function Q3CD_InsertNewColumnHandler() {
            //hide everything
            Hide_AllContentNodes(true);

            //set some variables to rep. elements
            let t0 = document.getElementById('entreeTbl'); //entree table
            let t1 = document.getElementById('entreeDsc'); //entree table desc.
            let b0 = document.getElementById('btn'); //add/del button

            //Update the heading
            Alter_Heading("Below is the current entree table and it's description. Click the button remove the 'entree_class' column from the table.");

            //Insert the new column
            Q3CD_InsertNewColumn();

            //Update the entree table and its description to show the new column
            Q3CD_UpdateEntreeTable();
            Q3CD_UpdateEntreeTableDesc();

            //Update the button to delete the column
            Utility_SetAttr(
                b0,
                ['onclick','value'],
                ['javascript: Q3CD_DeleteNewColumnHandler();','Delete Column']
            );

            //Unhide everything
            Hide_AllContentNodes(false);
        }
        function Q3CD_InsertNewColumn() {
            db_AddEntreeClassColumn(
                function (res) { }
            );
        }
        function Q3CD_DeleteNewColumnHandler() {
            //hide everything
            Hide_AllContentNodes(true);

            //set some variables to rep. elements
            let t0 = document.getElementById('entreeTbl'); //entree table
            let t1 = document.getElementById('entreeDsc'); //entree table desc.
            let b0 = document.getElementById('btn'); //add/del button

            //Update the heading
            Alter_Heading("Below is the current entree table and it's description. Click the button to add a new column to the table");

            //Delete the new column
            Q3CD_DeleteNewColumn();

            //Update the entree table and its description to show the new column
            Q3CD_UpdateEntreeTable();
            Q3CD_UpdateEntreeTableDesc();

            //Update the button to delete the column
            Utility_SetAttr(
                b0,
                ['onclick', 'value'],
                ['javascript: Q3CD_InsertNewColumnHandler();', 'Add Column']
            );

            //Unhide everything
            Hide_AllContentNodes(false);
        }
        function Q3CD_DeleteNewColumn() {
            db_DeleteEntreeClassColumn(
                function (res) { }
            );
        }
        //Q6 Functions
        function Q6_GeneratePage() {
            //hide everything
            Hide_AllContentNodes(true);

            //update the title and headings
            Alter_Title('Question 6');
            Alter_Heading('The three tables below are the restaurant, diner, and user tables. Use the sign up form to add a new user to the user table. A trigger will fire after the insertion on user. Depending on the user type a new record will be inserted into the diner or restaurant table')

            //create some elements
            let dtbl = document.createElement('div'); //diner table
            let rtbl = document.createElement('div'); //restaurant table
            let utbl = document.createElement('div'); //user table
            let f = Q6_SignUpForm(); //Sign Up Form
            let box0 = document.createElement('div'); //container for form
            let box1 = document.createElement('div'); //box to hold the rest diner, user tables
            let trtbl = document.createElement('div'); //will show user_add_t trigger

            //set some attributes
            Utility_SetAttrVariableValues(
                [dtbl,rtbl,utbl,f,box0,box1, trtbl],
                'id',
                ['dtbl','rtbl','utbl','signUpForm','formBox','uBox','trtbl']
            );

            Utility_SetAttrVariableValues(
                [box0, box1, rtbl, dtbl, utbl, trtbl],
                'style',
                ['float:left;', 'clear:both;width:100%;', 'float:left;max-width:25%;', 'float:left;max-width:25%;', 'float:left;max-width:50%','float:left;margin-left:3%;max-width: 70%']
            );
            //append everything to the document tree
            Utility_AppendChildern(
                box0,
                [f,trtbl]
            );
            Utility_AppendChildern(
                box1,
                [rtbl,dtbl,utbl]
            );
            Utility_AppendChildern(
                document.getElementById('hw_dynamicContent'),
                [box0, box1]
            );

            //Insert all the data and stuff
            Q6_UpdateDinerTable();
            Q6_UpdateResturantTable();
            Q6_UpdateUserTable();
            Q6_UserAddTrigger();
            //unhide everything
            Hide_AllContentNodes(false);

        }
        function Q6_SignUpForm() {
            //create elements
            let fbox = document.createElement('div'); //container to hold the form
            let f = document.createElement('form'); //form container
            let name = document.createElement('input'); //user name input text box
            let email = document.createElement('input'); //user email input text box
            let type = document.createElement('select'); //user type selection list
            let password = document.createElement('input'); //user password input text box
            let submit = document.createElement('input'); //submit button

            //set element attributes
            Utility_SetAttrVariableValues(
                [f,name,email,type,password,submit],
                'id',
                ['signUpForm', 'name', 'email', 'type', 'password', 'submit']
            );
            Utility_SetAttrVariableValues(
                [name,email,password,submit],
                'type',
                ['text','email','password','submit']
            );
            Utility_SetAttrVariableValues(
                [name, email, password],
                'placeholder',
                ['Enter User Name...', 'Enter Email...', 'Enter Password...']
            );
            Utility_SetAttrIdentical(
                [name, email, password],
                'size',
                '32'
            );
            Utility_SetAttr(
                f,
                ['action','class'],
                ['javascript:Q6_SignUpNewUserHandler();','usr-form']
            );
            Utility_SetAttrIdentical(
                [name,email,password],
                'required',
                'true'
            );
            submit.setAttribute('value', 'Sign Up');
            fbox.setAttribute('style','float:left;')
            //get user type select list
            db_UserTypes(
                function(res,elem) {
                    elem.innerHTML = res.responseText;
                },
                type,
                false
            );
            //append everything to form container
            f.appendChild(
                Utility_AppendForm(
                    undefined,
                    ['Name:','Email','Type','Password',''],
                    [name,email,type,password,submit]
                )
            );
            fbox.appendChild(f);
            
            //return the new form container
            return fbox;
        }
        function Q6_UpdateDinerTable() {
            Clear_ByElementId('dtbl');
            db_DinerTable(
                Insert_ResponseText,
                'dtbl',
                false
            );
        }
        function Q6_UpdateResturantTable() {
            Clear_ByElementId('rtbl');
            db_RestaurantTable(
                Insert_ResponseText,
                'rtbl',
                false
            );
        }
        function Q6_UpdateUserTable() {
            Clear_ByElementId('utbl');
            db_UserTable(
                Insert_ResponseText,
                'utbl',
                false
            );
        }
        function Q6_UserAddTrigger() {
            Clear_ByElementId('trtbl');
            db_UserAddTrigger(
                Insert_ResponseText,
                'trtbl',
                false
            );
        }
        function Q6_SignUpNewUserHandler() {
            //hide everything
            Hide_AllContentNodes(true);

            //insert new user
            signUp(
                function (res) {
                },
                document.getElementById('name').value,
                document.getElementById('email').value,
                document.getElementById('type').value,
                document.getElementById('password').value,
                false
            );

            //Update all the tables
            Q6_UpdateDinerTable();
            Q6_UpdateResturantTable();
            Q6_UpdateUserTable();

            //unhide everything
            Hide_AllContentNodes(false);
        }


        function Utility_SetVarById(v, ids) {
            for (let i = 0; i < v.length; i++) {
                v[i] = document.getElementById(ids[i]).value;
            }
        }
        function Utility_AppendChildern(p, c) {
            for (let i = 0; i < c.length; i++) {
                p.appendChild(c[i]);
            }
        }
        function Utility_SetAttr(elem, attrArray, attrValArray) {
            for (let i = 0; i < attrArray.length; i++) {
                elem.setAttribute(attrArray[i], attrValArray[i]);
            }
        }
        function Utility_SetAttrIdentical(elemArray, attr, attrVal) {
            for (let i = 0; i < elemArray.length; i++) {
                elemArray[i].setAttribute(attr, attrVal);
            }
        }
        function Utility_SetAttrVariable(elemArray, attr, attrVal) {
            for (let i = 0; i < elemArray.length; i++) {
                elemArray[i].setAttribute(attr[i], attrVal[i]);
            }
        }
        function Utility_SetAttrVariableValues(elemArray, attr, attrVal) {
            for (let i = 0; i < elemArray.length; i++) {
                elemArray[i].setAttribute(attr, attrVal[i]);
            }
        }
        function Utility_AppendForm(formID, lables, inputElems) {
            let f = document.createElement('table');
            for (let i = 0; i < lables.length; i++) {
                f.appendChild(Utility_FormEntry(lables[i], inputElems[i]));
            }
            return f;
        }

        var dispatcher = new DispatchHandler();
        function Init() {
            dispatcher.InsertPageHandler("Q1A", Q1A_GeneratePage, Clear_Page);
            dispatcher.InsertPageHandler("Q1B", Q1B_GeneratePage, Clear_Page);
            dispatcher.InsertPageHandler("Q1C", Q1C_GeneratePage, Clear_Page);
            dispatcher.InsertPageHandler("Q1D", Q1D_GeneratePage, Clear_Page);
            dispatcher.InsertPageHandler("Q1E", Q1E_GeneratePage, Clear_Page);
            dispatcher.InsertPageHandler("Q2", Q2_GeneratePage, Clear_Page);
            dispatcher.InsertPageHandler("Q3AB", Q3AB_GeneratePage, Clear_Page);
            dispatcher.InsertPageHandler("Q3CD", Q3CD_GeneratePage, Clear_Page);
            dispatcher.InsertPageHandler("Q6", Q6_GeneratePage, Clear_Page);
        }
        Init();
    </script>
</body>
</html>